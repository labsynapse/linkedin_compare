# Web2py install Makefile. To be called from top-level makefile.

# Have to change the shell because sh doesn't have source in Ubuntu.
SHELL = /bin/bash

# Web2py easy versioning :)
WEB2PY_DIR = web2py-R-2.9.10
WEB2PY_URL = https://codeload.github.com/web2py/web2py/zip/R-2.9.10


ifndef TARGET_WEB2PY_DIR
    $(error All rules in this makefile need TARGET_WEB2PY_DIR, which is \
			not defined by the root Makefile)
endif

ifndef ROOT_DIR
    ifneq ($(MAKECMDGOALS), install_web2py)
        $(error All rules except install_web2py need ROOT_DIR, which is \
			not defined by the root Makefile)
    endif
endif


.PHONY: all install install_web2py add_sitepackages
all:
	$(error Please specify target. Valid targets are: install_web2py, \
			add_sitepackages and install)

install: | install_web2py add_sitepackages

add_sitepackages:
	@echo 'site-packages symlink...'
	rm -fr $(TARGET_WEB2PY_DIR)/site-packages
	ln -s $(abspath $(ROOT_DIR)/site-packages) \
   		$(abspath $(TARGET_WEB2PY_DIR)/site-packages)

install_web2py:
	@echo 'Get web2py...'
	curl $(WEB2PY_URL) --output web2py.zip
	unzip web2py.zip
	rm web2py.zip
	mv $(WEB2PY_DIR) $(TARGET_WEB2PY_DIR)
